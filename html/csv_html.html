<script type="text/javascript">

	function addPacket (table, rows, packetNum) {
			<!-- get values from line -->
		var cells = rows.split(",");
		if (cells.length > 1) {
			switch (parseInt(cells[3])) {
				case 92:	//0x5C - K28.2 Start DLLP
					createDllpTable(table, cells, packetNum);
					break;
				case 251:	//0xFB - K27.7 Start TLP
					createTlpTable(table, cells, packetNum);
					break;
				default:
					break;	
			}
		}	
	}

	function createDllpTable(table, cells, packetNum) {
		var row = table.insertRow(-1);
		var cell = row.insertCell(-1);
		insertHeader (row, cell, cells);
		
		cell = row.insertCell(-1);
		cell.classList.add("DLLP_Packet");
		cell.innerHTML = "DLLP";
		cell.rowSpan = "2";
		
		createDllpPacket (row, cell, cells);
		
		
		row = table.insertRow(-1);
		cell = row.insertCell(-1);
		cell.innerHTML = packetNum;
		cell.classList.add("PNum");
		 
		 
		fillDllpPacket (row, cell, cells);
	}

	function createTlpTable(table, cells, packetNum) {
		var row = table.insertRow(-1);
		var cell = row.insertCell(-1);
		insertHeader (row, cell, cells);
		
		cell = row.insertCell(-1);
		cell.classList.add("TLP_Packet");
		cell.innerHTML = "TLP";	
		
		createTlpPacket (row, cell, cells)
		
		row = table.insertRow(-1);
		cell = row.insertCell(-1);
		cell.innerHTML = packetNum;
		cell.classList.add("PNum");
		
		fillTlpPacket (row, cell, cells);
	}
	
	function insertHeader (row, cell, cells) {
		cell.innerHTML = "Packet"
		cell.classList.add("PNum");
		<!-- Packet direction -->
		cell = row.insertCell(-1);
		cell.rowSpan = "2";
		if (cells[0] == "->") {
			cell.innerHTML = "R&rarr;";
			cell.classList.add("Up");
		} else {
			cell.innerHTML = "R&larr;";
			cell.classList.add("Down");
		}
	}
	
	function fillDllpPacket (row, cell, cells) {
		if (parseInt(cells[4]) == 0) {
			var seqNum = parseInt(cells[7]) + (parseInt(cells[6]))*256;
			cell = row.insertCell(-1);
			cell.innerHTML = seqNum;
		} else {
			cell = row.insertCell(-1);
			cell.innerHTML = "data 1";
			cell = row.insertCell(-1);
			cell.innerHTML = "data 2";
			cell = row.insertCell(-1);
			cell.innerHTML = "data 3";
		}
		cell = row.insertCell(-1);
		cell.innerHTML = "0x"+(cells[8].slice(3) + cells[9].slice(3)).toUpperCase();
		cell = row.insertCell(-1);
		cell.innerHTML = cells[1] + " ns";
	}
	
	function fillTlpPacket (row, cell, cells) {
		var seqNum = parseInt(cells[5]) + (parseInt(cells[4]))*256;
		cell = row.insertCell(-1);
		cell.innerHTML = seqNum;
		
		
		//FMT & Type
		cell = row.insertCell(-1);
		cell.innerHTML = "data";
		// LEN
		var len = parseInt(cells[9]) + (parseInt(cells[8])&3)*256;
		cell = row.insertCell(-1);
		cell.innerHTML = len;

		
		if ((parseInt(cells[6]) & 64) == 64) {
			//RequesterId
			cell = row.insertCell(-1);
			cell.innerHTML = "rq id";

			//Tag
			cell = row.insertCell(-1);
			cell.innerHTML = "tag";
			
			//Address
			cell = row.insertCell(-1);
			cell.innerHTML = "0x" + (cells[14].slice(3) + cells[15].slice(3) + cells[16].slice(3) + cells[17].slice(3)).toUpperCase();
			
			//BE
			cell = row.insertCell(-1);
			cell.innerHTML = "1111";
			cell = row.insertCell(-1);
			cell.innerHTML = "0000";
			//DATA
			cell = row.insertCell(-1);
			const newDiv = document.createElement("div");
			const newSpan = document.createElement("span");
			row.appendChild(cell);
			//cell = row.insertCell(-1);
			cell.appendChild(newDiv);
			newDiv.classList.add("tooltip");
			newDiv.innerHTML = len + "DW";
			newDiv.appendChild(newSpan);
			newSpan.classList.add("tooltiptext");
			for (var i = 0; i < (len * 4); i++) {
				newSpan.innerHTML += cells[18 + i];
			}
			//CRC
			cell = row.insertCell(-1);
			cell.innerHTML = "0x" + (cells[cells.length - 5].slice(3) + cells[cells.length - 4].slice(3) + cells[cells.length - 3].slice(3) + cells[cells.length - 2].slice(3)).toUpperCase();
			//Timestamp
			cell = row.insertCell(-1);
			cell.innerHTML = cells[1] + " ns";
		}
	}
	
	function createTlpPacket (row, cell, cells) {
		
		
		if ((parseInt(cells[6]) & 64) == 64) {
			cell = row.insertCell(-1);
			cell.rowSpan = "2";	
			cell.classList.add("Mwr");
			cell.innerHTML = "Mem";
			
			cell = row.insertCell(-1);
			cell.classList.add("Mwr");
			cell.innerHTML = "MWr(32)";
			
			cell = row.insertCell(-1);
			cell.classList.add("Mwr");
			cell.innerHTML = "Length";
			
			cell = row.insertCell(-1);
			cell.classList.add("ReqId");
			cell.innerHTML = "RequesterId";
			
			cell = row.insertCell(-1);
			cell.classList.add("ReqId");
			cell.innerHTML = "Tag";
			
			cell = row.insertCell(-1);
			cell.classList.add("Addr");
			cell.innerHTML = "Address";
			
			cell = row.insertCell(-1);
			cell.classList.add("BE");
			cell.innerHTML = "1st BE";
			
			cell = row.insertCell(-1);
			cell.classList.add("BE");
			cell.innerHTML = "Last BE";
			
			cell = row.insertCell(-1);
			cell.classList.add("Data");
			cell.innerHTML = "Data";
		}
		cell = row.insertCell(-1);
		cell.classList.add("CRC_16");
		cell.innerHTML = "CRC";
		
		cell = row.insertCell(-1);
		cell.classList.add("Timestamp");
		cell.innerHTML = "Timestamp";
		
	}
	
	function createDllpPacket (row, cell, cells) {
		cell = row.insertCell(-1);
		cell.rowSpan = "2";
		
		if (parseInt(cells[4]) == 0) {
			cell.classList.add("ACK_Packet");
			cell.innerHTML = "ACK";
			
			cell = row.insertCell(-1);
			cell.classList.add("ACK_Packet");
			cell.innerHTML = "AckNak_Seq_Num";
		}
		if ((parseInt(cells[4])&240) == 64) {
			cell.classList.add("InitFC");
			cell.innerHTML = "InitFC1-P";
			
			cell = row.insertCell(-1);
			cell.classList.add("InitFC");
			cell.innerHTML = "VC ID";
			
			cell = row.insertCell(-1);
			cell.classList.add("InitFC");
			cell.innerHTML = "HdrVC";
			
			cell = row.insertCell(-1);
			cell.classList.add("InitFC");
			cell.innerHTML = "DataFC";
		}	
		if ((parseInt(cells[4])&80) == 80) {
			cell.classList.add("InitFC");
			cell.innerHTML = "InitFC1-NP";
		}	
		if ((parseInt(cells[4])&96) == 96) {
			cell.classList.add("InitFC");
			cell.innerHTML = "InitFC1-Cpl";
		}
		if ((parseInt(cells[4])&192) == 192) {
			cell.classList.add("InitFC");
			cell.innerHTML = "InitFC2-P";
		}
		if ((parseInt(cells[4])&208) == 208) {
		}
		if ((parseInt(cells[4])&224) == 224) {
		}
		cell = row.insertCell(-1);
		cell.classList.add("CRC_16");
		cell.innerHTML = "CRC";
		
		cell = row.insertCell(-1);
		cell.classList.add("Timestamp");
		cell.innerHTML = "Timestamp";
	}
	
    function Upload() {
        var fileUpload = document.getElementById("fileUpload");
		var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.csv|.txt)$/;
        if (regex.test(fileUpload.value.toLowerCase())) {
            if (typeof (FileReader) != "undefined") {
                var reader = new FileReader();
                reader.onload = function (e) {
                    var table = document.createElement("table");
                    var rows = e.target.result.split("\n");
                    for (var i = 0; i < rows.length; i++) {
					
						addPacket(table, rows[i], i);

                    }
                    var dvCSV = document.getElementById("dvCSV");
                    dvCSV.innerHTML = "";
                    dvCSV.appendChild(table);
                }
                reader.readAsText(fileUpload.files[0]);
            } else {
                alert("This browser does not support HTML5.");
            }
        } else {
            alert("Please upload a valid CSV file.");
        }
    }
</script>

<style type="text/css">

* {font-size: small;}
td {border: 1px solid black;
	text-align: center;}
th.PNum, td.PNum{background-color:#f9f;}
					
th.Up, td.Up{background-color:#eba834;}
				
th.Down, td.Down{background-color:#7d5500;color: #fff;}
td.TLP_Packet {background-color:#ed9a09;}
td.DLLP_Packet {background-color:#18d60b;}
td.ACK_Packet {background-color:#fff200;}
td.InitFC {background-color:#185c11; color: #fff;}
td.CRC_16 {background-color:#808080;}
td.Timestamp {background-color:#0012d9; color: #fff;}
td.Mwr {background-color:#000a7a; color: #fff;}
td.ReqId {background-color:#0f994b;}
td.Addr{background-color:#00d5ff;}
td.BE{background-color:#3dffa8;}
td.Data{background-color:#b82b00;color: #fff;}


.tooltip {
			height:100%
			margin: 0px;}
.tooltiptext {
  visibility: hidden;
  width: 220px;
  background-color: black;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px 0;

  /* Position the tooltip */
  position: absolute;
  z-index: 1;
}
.tooltip:hover .tooltiptext {
  visibility: visible;
}





</style>
<input type="file" id="fileUpload" />
<input type="button" id="upload" value="Upload" onclick="Upload()" />
<hr />
<div id="dvCSV">
</div>